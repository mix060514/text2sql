# Text-to-SQL å¤šä»£ç†ç³»çµ±

ä¸€å€‹åŸºæ–¼ Google ADK çš„è‡ªç„¶èªè¨€è½‰ SQL æŸ¥è©¢ç³»çµ±ï¼Œæ¡ç”¨å¤šä»£ç†å”ä½œæ¶æ§‹ï¼Œå…·å‚™è‡ªæˆ‘ä¿®æ­£èƒ½åŠ›èˆ‡ LLM-as-Judge è©•ä¼°æ©Ÿåˆ¶ã€‚

## ğŸ”— Demo

**ç·šä¸Šå±•ç¤º**ï¼š[https://agent-show.ivan-labs.com](https://agent-show.ivan-labs.com)

> âš ï¸ éƒ¨ç½²æ–¼æœ¬åœ°ä¸»æ©Ÿï¼Œè¨ªå•å‰è«‹å…ˆè¯ç¹«ä½œè€…åŠ å…¥ Cloudflare Zero Trust ç™½åå–®


### ç•«é¢é è¦½

| ä»£ç†åŸ·è¡Œéç¨‹ | è©•ä¼°çµæœ |
|:--------:|:--------:|
| ![Chat](./assets/screenshots/chat.png) | ![Eval](./assets/screenshots/eval.png) |

| è³‡æ–™å„€è¡¨æ¿ | å¤šæ¨¡æ…‹æœ¬åœ°æ¨¡å‹ |
|:--------:|:--------:|
| ![Dashboard](./assets/screenshots/dashboard.png) | ![Image_Read](./assets/screenshots/image_read.png) |


## å°ˆæ¡ˆäº®é»

- **å¤šä»£ç†å”ä½œæ¶æ§‹**ï¼šæ¡ç”¨ SequentialAgent + LoopAgent è¨­è¨ˆï¼Œå¯¦ç¾ä»»å‹™åˆ†è§£èˆ‡è¿­ä»£å„ªåŒ–
- **è‡ªæˆ‘ä¿®æ­£æ©Ÿåˆ¶**ï¼šé€é Critic Agent å¯©æŸ¥æŸ¥è©¢çµæœï¼Œè‡ªå‹•è§¸ç™¼é‡è©¦ä¿®æ­£ï¼ˆæœ€å¤š 3 æ¬¡ï¼‰
- **å®Œæ•´è©•ä¼°æ¡†æ¶**ï¼šåŒ…å« 100+ æ¸¬è©¦æ¡ˆä¾‹ï¼Œæ­é… LLM-as-Judge è‡ªå‹•è©•åˆ†
- **æœ¬åœ°æ¨¡å‹éƒ¨ç½²**ï¼šä½¿ç”¨ llama.cpp é‹è¡Œ Qwen3-4Bï¼Œæ”¯æ´é›¢ç·šé‹è¡Œ

## ç³»çµ±æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Root Agent                              â”‚
â”‚                    (ä»»å‹™åˆ†æ´¾èˆ‡å›æ‡‰æ•´åˆ)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Query & Answer Agent                           â”‚
â”‚                    (SequentialAgent)                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              Get Data Agent (LoopAgent)                    â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  SQL Generation Sequential                           â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ Region/Country Check Agent (åˆ¥åæ˜ å°„)              â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€ SQL Gen Agent (SQL ç”Ÿæˆ)                          â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                          â–¼                                 â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  SQL Critic Sequential                               â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ Check SQL Agent (èªæ³•æª¢æŸ¥)                        â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ Execute SQL Agent (åŸ·è¡ŒæŸ¥è©¢)                      â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€ Critic Agent (çµæœå¯©æŸ¥ â†’ æ±ºå®šæ˜¯å¦é‡è©¦)              â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚              â†» Loop until correct or max retries           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                          â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              Answer Agent (å•†æ¥­èªè¨€å›è¦†)                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å°ˆæ¡ˆçµæ§‹

```
.
â”œâ”€â”€ src/text2sql/agents/          # æ ¸å¿ƒä»£ç†ç³»çµ±
â”‚   â”œâ”€â”€ planned_agent/            # ä¸»è¦ Text-to-SQL ä»£ç†
â”‚   â””â”€â”€ pic_read_agent/           # è¦–è¦ºèªè¨€æ¨¡å‹ä»£ç†
â”‚
â”œâ”€â”€ eval/                         # è©•ä¼°ç³»çµ±
â”‚   â”œâ”€â”€ eval.py                   # è©•ä¼°åŸ·è¡Œè…³æœ¬
â”‚   â””â”€â”€ judge/                    # LLM-as-Judge è©•åˆ†ä»£ç†
â”‚
â”œâ”€â”€ scripts/                      # è³‡æ–™èˆ‡è©•ä¼°é›†ç”Ÿæˆè…³æœ¬
â”‚
â”œâ”€â”€ web_ui/                       # Streamlit Web ä»‹é¢
â”‚   â”œâ”€â”€ 1_Chat.py                 # å°è©±ä»‹é¢ï¼ˆå¯è§€å¯Ÿä»£ç†åŸ·è¡Œéç¨‹ï¼‰
â”‚   â”œâ”€â”€ 2_Eval.py                 # è©•ä¼°çµæœæª¢è¦–
â”‚   â”œâ”€â”€ 3_System_Monitor.py       # GPU ç›£æ§
â”‚   â”œâ”€â”€ 4_Data_Dashboard.py       # è³‡æ–™è¦–è¦ºåŒ–
â”‚   â””â”€â”€ 5_Image_Read_Chat.py      # åœ–ç‰‡ç†è§£å°è©±
â”‚
â””â”€â”€ data/                         # åˆæˆéŠ·å”®è³‡æ–™èˆ‡è©•ä¼°é›†
```

## é–‹ç™¼æµç¨‹

æ¡ç”¨**è©•ä¼°é©…å‹•é–‹ç™¼ (Evaluation-Driven Development)**ï¼š

```
1. å»ºç«‹è©•ä¼°è³‡æ–™é›†    â†’    2. é–‹ç™¼ä»£ç†ç³»çµ±    â†’    3. LLM Judge è©•åˆ†    â†’    4. è¿­ä»£å„ªåŒ–
   (scripts/)              (src/)                 (eval/)                  (web_ui é©—è­‰)
```

## æŠ€è¡“ç´°ç¯€

### ä»£ç†è¨­è¨ˆæ¨¡å¼

```python
# LoopAgent: è‡ªæˆ‘ä¿®æ­£è¿´åœˆ
get_data_agent = LoopAgent(
    sub_agents=[sql_gen_sequential, sql_critic_sequential],
    max_iterations=3  # æœ€å¤šé‡è©¦ 3 æ¬¡
)

# Critic Agent: é€é exit_loop å·¥å…·æ§åˆ¶è¿´åœˆ
def exit_loop(tool_context: ToolContext):
    tool_context.actions.escalate = True  # è·³å‡ºè¿´åœˆ
```

### åˆ¥åæ˜ å°„

æ”¯æ´å¤šèªè¨€è¼¸å…¥è‡ªå‹•è½‰æ›ï¼š

| ä½¿ç”¨è€…è¼¸å…¥ | è³‡æ–™åº«å€¼ |
|-----------|---------|
| äºå¤ªå€ / APAC / Asia Pacific | `Region = 'APAC'` |
| ä¸­åœ‹ / China / å¤§é™¸ | `Country = 'China'` |

### LLM-as-Judge

- ä½¿ç”¨ Structured Output ç¢ºä¿è©•åˆ†æ ¼å¼ä¸€è‡´
- è©•ä¼°ç¶­åº¦ï¼šç­”æ¡ˆæ­£ç¢ºæ€§ã€æ•¸æ“šæº–ç¢ºæ€§ã€å›ç­”å®Œæ•´æ€§
- è¼¸å‡º 0-10 ä¿¡å¿ƒåˆ†æ•¸ï¼Œâ‰¥7 è¦–ç‚ºæ­£ç¢º

## æ•¸æ“šç¯„ä¾‹

å…¨çƒéŠ·å”®æ•¸æ“šå‰ 5 è¡Œï¼š

| Order ID | Order Date | Region | Country | Customer Name | Product Category | Product Name | ASP | Quantity | Total Revenue |
|----------|-----------|--------|---------|----------------|------------------|--------------|-----|----------|---------------|
| ORD-202309986 | 2023-01-01 | North America | United States | Elite Elite Systems | Electronics | Docking Station | 184.04 | 6 | 1104.24 |
| ORD-202325336 | 2023-01-01 | LATAM | Mexico | Apex Elite Systems | Electronics | 4K Monitor 27" | 345.53 | 11 | 3800.83 |
| ORD-202315895 | 2023-01-01 | North America | United States | Apex Apex Ltd. | Electronics | Pro Smartphone 15 | 1002.65 | 3 | 3007.95 |
| ORD-202328380 | 2023-01-01 | EMEA | United Kingdom | Next Beta Ltd. | Software | Team Collaboration Tool | 208.97 | 5 | 1044.85 |
| ORD-202318954 | 2023-01-01 | APAC | Singapore | Next Delta Ltd. | Office Supplies | Ergonomic Chair | 382.53 | 2 | 765.06 |

## æŠ€è¡“æ£§

| é¡åˆ¥ | æŠ€è¡“ |
|------|------|
| Agent Framework | Google ADK |
| LLM | Qwen3-4B-Instruct (via llama.cpp) |
| Database | SQLite |
| Web UI | Streamlit |

## è¯çµ¡ä½œè€…

- LinkedIn: [https://www.linkedin.com/in/yi-fan-zhang-1ba122171/]

## License

MIT
